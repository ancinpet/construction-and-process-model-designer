(window.webpackJsonp=window.webpackJsonp||[]).push([[284],{1619:function(e,o,t){"use strict";t.r(o);var n,r=t(574),i=t(615),s=t.n(i),a=t(565),p=t(585),l=t.n(p),u=t(950),c=t(923),m=t(605),d=t(774),g=t(582),h=(n=function(e,o){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t])})(e,o)},function(e,o){function t(){this.constructor=e}n(e,o),e.prototype=null===o?Object.create(o):(t.prototype=o.prototype,new t)}),f=function(e){function o(){var o=null!==e&&e.apply(this,arguments)||this;return o.handleToggleUser=function(e,t){return e.permissions.includes(t)?o.props.revokePermissionFromUser(e.login,t):o.props.grantPermissionToUser(e.login,t)},o.handleToggleGroup=function(e,t){return e.permissions.includes(t)?o.props.revokePermissionFromGroup(e.name,t):o.props.grantPermissionToGroup(e.name,t)},o.handleSelectPermission=function(e){o.props.onPermissionSelect(e)},o}return h(o,e),o.prototype.render=function(){var e=this.props,o=e.filter,t=e.groups,n=e.groupsPaging,r=e.users,i=e.usersPaging,p=d.a[this.props.component.qualifier];this.props.visibility===g.i.Public&&(p=s()(p,"user","codeviewer"));var l=Object(d.e)(p,"projects_role"),h=0,f=0;return"users"!==o&&(h+=t.length,f+=n?n.total:t.length),"groups"!==o&&(h+=r.length,f+=i?i.total:r.length),a.createElement(a.Fragment,null,a.createElement(c.a,{filter:this.props.filter,groups:this.props.groups,onSelectPermission:this.handleSelectPermission,onToggleGroup:this.handleToggleGroup,onToggleUser:this.handleToggleUser,permissions:l,query:this.props.query,selectedPermission:this.props.selectedPermission,users:this.props.users},a.createElement(u.a,{filter:this.props.filter,onFilter:this.props.onFilterChange,onSearch:this.props.onQueryChange,query:this.props.query})),a.createElement(m.a,{count:h,loadMore:this.props.onLoadMore,total:f}))},o}(a.PureComponent),y=t(1079),P=t(567),v=t(13),b=function(){var e=function(o,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t])})(o,t)};return function(o,t){function n(){this.constructor=o}e(o,t),o.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),_=function(e){function o(){var o=null!==e&&e.apply(this,arguments)||this;return o.mounted=!1,o.state={applyTemplateModal:!1},o.handleApplyTemplate=function(){o.setState({applyTemplateModal:!0})},o.handleApplyTemplateClose=function(){o.mounted&&o.setState({applyTemplateModal:!1})},o}return b(o,e),o.prototype.componentDidMount=function(){this.mounted=!0},o.prototype.componentWillUnmount=function(){this.mounted=!1},o.prototype.render=function(){var e=this.props.component,o=e.configuration,t=null!=o&&o.canApplyPermissionTemplate,n=["VW","SVW","APP"].includes(e.qualifier)?Object(v.l)("roles.page.description_portfolio"):Object(v.l)("roles.page.description2"),r="TRK"===e.qualifier&&e.visibility?Object(v.l)("visibility",e.visibility,"description",e.qualifier):void 0;return a.createElement("header",{className:"page-header"},a.createElement("h1",{className:"page-title"},Object(v.l)("permissions.page")),this.props.loading&&a.createElement("i",{className:"spinner"}),t&&a.createElement("div",{className:"page-actions"},a.createElement(P.a,{className:"js-apply-template",onClick:this.handleApplyTemplate},Object(v.l)("projects_role.apply_template")),this.state.applyTemplateModal&&a.createElement(y.a,{onApply:this.props.loadHolders,onClose:this.handleApplyTemplateClose,organization:e.organization,project:e})),a.createElement("div",{className:"page-description"},a.createElement("p",null,n),r&&a.createElement("p",null,r)))},o}(a.PureComponent),j=t(613);function C(e){var o=e.component,t=e.onClose,n=e.onConfirm,r=o.qualifier;return a.createElement(j.a,{confirmButtonText:Object(v.l)("projects_role.turn_project_to_public",r),header:Object(v.m)("projects_role.turn_x_to_public",o.name),onClose:t,onConfirm:n},a.createElement("div",{className:"alert alert-warning modal-alert"},Object(v.l)("projects_role.are_you_sure_to_turn_project_to_public.warning",r)),a.createElement("p",null,Object(v.l)("projects_role.are_you_sure_to_turn_project_to_public",r)))}var T=t(948),S=t(1078),E=t(704),O=(t(949),function(){var e=function(o,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t])})(o,t)};return function(o,t){function n(){this.constructor=o}e(o,t),o.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}()),U=function(){return(U=Object.assign||function(e){for(var o,t=1,n=arguments.length;t<n;t++)for(var r in o=arguments[t])Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r]);return e}).apply(this,arguments)},F=function(e){function o(o){var t=e.call(this,o)||this;return t.mounted=!1,t.stopLoading=function(){t.mounted&&t.setState({loading:!1})},t.loadUsersAndGroups=function(e,o){var n=t.props.component,r=t.state,i=r.filter,s=r.query,a=r.selectedPermission,p="groups"!==i?E.n({projectKey:n.key,q:s||void 0,permission:a,organization:n.organization,p:e}):Promise.resolve({paging:void 0,users:[]}),l="users"!==i?E.m({projectKey:n.key,q:s||void 0,permission:a,organization:n.organization,p:o}):Promise.resolve({paging:void 0,groups:[]});return Promise.all([p,l])},t.loadHolders=function(){return t.setState({loading:!0}),t.loadUsersAndGroups().then(function(e){var o=e[0],n=e[1];t.mounted&&t.setState({groups:n.groups,groupsPaging:n.paging,loading:!1,users:o.users,usersPaging:o.paging})},t.stopLoading)},t.onLoadMore=function(){var e=t.state,o=e.usersPaging,n=e.groupsPaging;return t.setState({loading:!0}),t.loadUsersAndGroups(o?o.pageIndex+1:1,n?n.pageIndex+1:1).then(function(e){var o=e[0],n=e[1];t.mounted&&t.setState(function(e){var t=e.groups,r=e.users;return{groups:t.concat(n.groups),groupsPaging:n.paging,loading:!1,users:r.concat(o.users),usersPaging:o.paging}})},t.stopLoading)},t.handleFilterChange=function(e){t.mounted&&t.setState({filter:e},t.loadHolders)},t.handleQueryChange=function(e){t.mounted&&t.setState({query:e},t.loadHolders)},t.handlePermissionSelect=function(e){t.mounted&&t.setState(function(o){return{selectedPermission:o.selectedPermission===e?void 0:e}},t.loadHolders)},t.addPermissionToGroup=function(e,o){return t.state.groups.map(function(t){return t.name===e?U({},t,{permissions:t.permissions.concat([o])}):t})},t.addPermissionToUser=function(e,o){return t.state.users.map(function(t){return t.login===e?U({},t,{permissions:t.permissions.concat([o])}):t})},t.removePermissionFromGroup=function(e,o){return t.state.groups.map(function(t){return t.name===e?U({},t,{permissions:s()(t.permissions,o)}):t})},t.removePermissionFromUser=function(e,o){return t.state.users.map(function(t){return t.login===e?U({},t,{permissions:s()(t.permissions,o)}):t})},t.grantPermissionToGroup=function(e,o){return t.mounted?(t.setState({loading:!0,groups:t.addPermissionToGroup(e,o)}),E.o({projectKey:t.props.component.key,groupName:e,permission:o,organization:t.props.component.organization}).then(t.stopLoading,function(){t.mounted&&t.setState({loading:!1,groups:t.removePermissionFromGroup(e,o)})})):Promise.resolve()},t.grantPermissionToUser=function(e,o){return t.mounted?(t.setState({loading:!0,users:t.addPermissionToUser(e,o)}),E.p({projectKey:t.props.component.key,login:e,permission:o,organization:t.props.component.organization}).then(t.stopLoading,function(){t.mounted&&t.setState({loading:!1,users:t.removePermissionFromUser(e,o)})})):Promise.resolve()},t.revokePermissionFromGroup=function(e,o){return t.mounted?(t.setState({loading:!0,groups:t.removePermissionFromGroup(e,o)}),E.t({projectKey:t.props.component.key,groupName:e,permission:o,organization:t.props.component.organization}).then(t.stopLoading,function(){t.mounted&&t.setState({loading:!1,groups:t.addPermissionToGroup(e,o)})})):Promise.resolve()},t.revokePermissionFromUser=function(e,o){return t.mounted?(t.setState({loading:!0,users:t.removePermissionFromUser(e,o)}),E.u({projectKey:t.props.component.key,login:e,permission:o,organization:t.props.component.organization}).then(t.stopLoading,function(){t.mounted&&t.setState({loading:!1,users:t.addPermissionToUser(e,o)})})):Promise.resolve()},t.handleVisibilityChange=function(e){e===g.i.Public?t.openDisclaimer():t.turnProjectToPrivate()},t.turnProjectToPublic=function(){t.props.onComponentChange({visibility:g.i.Public}),E.e(t.props.component.key,g.i.Public).then(function(){t.loadHolders()},function(){t.props.onComponentChange({visibility:g.i.Private})})},t.turnProjectToPrivate=function(){t.props.onComponentChange({visibility:g.i.Private}),E.e(t.props.component.key,g.i.Private).then(function(){t.loadHolders()},function(){t.props.onComponentChange({visibility:g.i.Public})})},t.openDisclaimer=function(){t.mounted&&t.setState({disclaimer:!0})},t.closeDisclaimer=function(){t.mounted&&t.setState({disclaimer:!1})},t.state={disclaimer:!1,filter:"all",groups:[],loading:!0,query:"",users:[]},t}return O(o,e),o.prototype.componentDidMount=function(){this.mounted=!0,this.loadHolders()},o.prototype.componentWillUnmount=function(){this.mounted=!1},o.prototype.render=function(){var e=null!=this.props.component.configuration&&this.props.component.configuration.canUpdateProjectVisibilityToPrivate;return a.createElement("div",{className:"page page-limited",id:"project-permissions-page"},a.createElement(l.a,{title:Object(v.l)("permissions.page")}),a.createElement(_,{component:this.props.component,loadHolders:this.loadHolders,loading:this.state.loading}),a.createElement("div",null,a.createElement(S.a,{canTurnToPrivate:e,className:"big-spacer-top big-spacer-bottom",onChange:this.handleVisibilityChange,visibility:this.props.component.visibility}),"TRK"===this.props.component.qualifier&&!e&&a.createElement(T.a,{organization:this.props.component.organization}),this.state.disclaimer&&a.createElement(C,{component:this.props.component,onClose:this.closeDisclaimer,onConfirm:this.turnProjectToPublic})),a.createElement(f,{component:this.props.component,filter:this.state.filter,grantPermissionToGroup:this.grantPermissionToGroup,grantPermissionToUser:this.grantPermissionToUser,groups:this.state.groups,groupsPaging:this.state.groupsPaging,onFilterChange:this.handleFilterChange,onLoadMore:this.onLoadMore,onPermissionSelect:this.handlePermissionSelect,onQueryChange:this.handleQueryChange,query:this.state.query,revokePermissionFromGroup:this.revokePermissionFromGroup,revokePermissionFromUser:this.revokePermissionFromUser,selectedPermission:this.state.selectedPermission,users:this.state.users,usersPaging:this.state.usersPaging,visibility:this.props.component.visibility}))},o}(a.PureComponent),k=t(578);o.default=Object(r.connect)(function(e){return{currentUser:Object(k.getCurrentUser)(e)}})(F)},613:function(e,o,t){"use strict";var n,r=t(565),i=t(597),s=t(580),a=t(13),p=t(567),l=(n=function(e,o){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t])})(e,o)},function(e,o){function t(){this.constructor=e}n(e,o),e.prototype=null===o?Object.create(o):(t.prototype=o.prototype,new t)}),u=function(e){function o(){var o=null!==e&&e.apply(this,arguments)||this;return o.mounted=!1,o.handleSubmit=function(){var e=o.props.onConfirm(o.props.confirmData);return e?e.then(o.props.onClose,function(){}):void o.props.onClose()},o.renderModalContent=function(e){var t=e.onCloseClick,n=e.onFormSubmit,i=e.submitting,l=o.props,u=l.children,c=l.confirmButtonText,m=l.confirmDisable,d=l.header,g=l.isDestructive;return r.createElement("form",{onSubmit:n},r.createElement("header",{className:"modal-head"},r.createElement("h2",null,d)),r.createElement("div",{className:"modal-body"},u),r.createElement("footer",{className:"modal-foot"},r.createElement(s.a,{className:"spacer-right",loading:i}),r.createElement(p.f,{autoFocus:!0,className:g?"button-red":void 0,disabled:i||m},c),r.createElement(p.e,{disabled:i,onClick:t},Object(a.l)("cancel"))))},o}return l(o,e),o.prototype.componentDidMount=function(){this.mounted=!0},o.prototype.componentWillUnmount=function(){this.mounted=!1},o.prototype.render=function(){var e=this.props.header;return r.createElement(i.a,{header:e,onClose:this.props.onClose,onSubmit:this.handleSubmit},this.renderModalContent)},o}(r.PureComponent);o.a=u}}]);
//# sourceMappingURL=284.882d1d2c.chunk.js.map